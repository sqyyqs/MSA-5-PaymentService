# Шаблон ADR

## Общая информация

1. Родительский артефакт - ...
2. Автор ADR - Демин Константин Евгеньевич
3. Статус - [Принят, На согласовании, Отклонен, В проработке]
4. Согласующие - ...

## Контекст

Решение по размещению оркестратора. Стоит выбор между реализацией его в одном из существующих сервисов или в новом отдельном сервисе, занимающегося
оркестрацией.

Среди существующих сервисов, на момент написания ADR:

1) Payment Service — основной сервис обработки платежей.
2) FraudCheck Service — анализирует транзакции по внутренним правилам и через внешних провайдеров.
3) Notification Service — отправляет клиентам уведомления о статусах операций.

## Рассмотренные варианты

### Вариант «In-Service Orchestrator»

Оркестратор будет расположен в одном из сервисов, предположительно в том, в котором начинается бизнес процесс, т.е. Payment Service.

Пример: [диаграмма](in-service-orchestrator.puml)

### Альтернатива «Separate Orchestrator»

Оркестратор разворачивается как отдельный сервис, и управляет процессом отдельно.

Пример: [диаграмма](additional-service-orchestrator.puml)

## Сравнение

| Вариант решения | Преимущества                                                                                                                              | Недостатки                                                                                                                         |
|-----------------|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------|
| Вариант №1      | Лучше подходит для ситуаций, когда процесс будет часто меняться (добавляться шаги и проч.) <br> Централизует хранение состояния процесса. | Дополнительная нагрузка на деплой; дополнительная нагрузка на сеть (больше шагов)                                                  |
| Вариант №2      | Легче в реализации, лучше производительность.                                                                                             | Логика бп смешивается с остальным кодом приложения, при выкатке новой версии процесса придется обновлять версию одного из сервисов |

## Принятое решение

Принятое решение: вариант 1, поскольку в процесс могут и будут добавляться новые шаги по мере развития функционала. Расположение логики исполнения
бизнес-процесса в одном из сервисов будет лишь путать.

- Если расположить логику в Payment Service, то придется разворачивать новую версию сервиса при изменении процесса, что очень нежелательно для
  сервиса, проводящего платежи. Он должен работать стабильно
- Расположение логики в FraudCheck / NotificationService тоже выглядит некорректным, поскольку они занимаются конкретными доменными задачами. При
  задании им дополнительной логики мы повышаем их зависимость от других сервисов, тем самым нарушая принципы микросервисной архитектуры.

Поэтому оркестратор бизнес-процесса будет расположен в новом сервисе, несмотря на дополнительные сопутствующие расходы.
